<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Pedidos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            text-align: center;
            color: #0056b3;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea,
        select {
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            font-size: 16px;
        }
        textarea {
            resize: vertical; /* Allow vertical resizing */
            min-height: 80px;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .product-list {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        .product-item:last-child {
            border-bottom: none;
        }
        .product-name {
            flex-grow: 1;
        }
        .product-quantity {
            font-weight: bold;
            margin-left: 10px;
        }
        .no-data {
            text-align: center;
            color: #888;
            margin-top: 20px;
        }

        /* Responsividade */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            input[type="text"],
            input[type="number"],
            input[type="date"],
            textarea,
            select {
                font-size: 14px;
            }
            button {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gerenciador de Pedidos</h1>

        <div class="form-group">
            <label for="orderDate">Data do Pedido:</label>
            <input type="date" id="orderDate">
        </div>

        <h2>Adicionar Produto</h2>
        <div class="form-group">
            <label for="productName">Nome do Produto:</label>
            <select id="productName">
                <option value="">Selecione um produto</option>
                <optgroup label="Pães">
                    <option value="Pão 06h">Pão 06h</option>
                    <option value="Pão 12h">Pão 12h</option>
                    <option value="Sovado">Sovado</option>
                    <option value="Baguete G">Baguete G</option>
                    <option value="Baguete M">Baguete M</option>
                    <option value="Integral">Integral</option>
                </optgroup>
                <optgroup label="Folhados">
                    <option value="Folhado Frango">Folhado Frango</option>
                    <option value="Folhado Misto">Folhado Misto</option>
                    <option value="Folhado Queijo">Folhado Queijo</option>
                    <option value="Folhado C. Sol">Folhado C. Sol</option>
                </optgroup>
                <optgroup label="Croissant">
                    <option value="Croissant Misto">Croissant Misto</option>
                    <option value="Croissant Queijo">Croissant Queijo</option>
                    <option value="Croissant Frango">Croissant Frango</option>
                    <option value="Croissant C. Sol">Croissant C. Sol</option>
                    <option value="Croissant S/recheio">Croissant S/recheio</option>
                </optgroup>
                <optgroup label="Empadas">
                    <option value="Empada Frango">Empada Frango</option>
                    <option value="Empada C. Sol">Empada C. Sol</option>
                    <option value="Empadinha">Empadinha</option>
                </optgroup>
                <optgroup label="Outros Salgados">
                    <option value="Pão de Queijo">Pão de Queijo</option>
                    <option value="Coxinha">Coxinha</option>
                    <option value="Bola">Bola</option>
                    <option value="Risole">Risole</option>
                    <option value="Enrolado">Enrolado</option>
                    <option value="Mini Coxinha">Mini Coxinha</option>
                    <option value="Mini Bolinha">Mini Bolinha</option>
                    <option value="Pastel Queijo">Pastel Queijo</option>
                    <option value="Pastel Carne">Pastel Carne</option>
                </optgroup>
            </select>
        </div>
        <div class="form-group">
            <label for="productQuantity">Quantidade:</label>
            <input type="number" id="productQuantity" min="1" value="1">
        </div>
        <button onclick="addProduct()">Adicionar ao Pedido</button>

        <h2>Itens do Pedido</h2>
        <div id="orderItems" class="product-list">
            <p class="no-data">Nenhum produto adicionado ainda.</p>
        </div>

        <div class="form-group">
            <label for="observations">Observações:</label>
            <textarea id="observations" placeholder="Insira observações sobre o pedido..."></textarea>
        </div>

        <div class="form-group">
            <label for="whatsappRecipient">Número de Telefone do WhatsApp (com código do país, ex: +5511987654321):</label>
            <input type="text" id="whatsappRecipient" placeholder="Ex: +5511987654321">
        </div>

        <button onclick="saveOrder()">Salvar Pedido</button>
        <button onclick="finalizeAndSendOrder()">Finalizar e Enviar via WhatsApp</button>
        <button onclick="clearOrder()">Limpar Pedido</button>
    </div>

    <script>
        const orderItems = []; // Array para armazenar os itens do pedido

        // Define a data atual no campo de data
        window.onload = function() {
            const today = new Date();
            const yyyy = today.getFullYear();
            let mm = today.getMonth() + 1; // Months start at 0!
            let dd = today.getDate();

            if (dd < 10) dd = '0' + dd;
            if (mm < 10) mm = '0' + mm;

            document.getElementById('orderDate').value = yyyy + '-' + mm + '-' + dd;
            renderOrderItems(); // Renderiza itens salvos no localStorage, se houver
        };

        function addProduct() {
            const productNameSelect = document.getElementById('productName');
            const productName = productNameSelect.value;
            const productQuantity = parseInt(document.getElementById('productQuantity').value);

            if (productName && productQuantity > 0) {
                // Verifica se o produto já existe no array
                const existingProductIndex = orderItems.findIndex(item => item.name === productName);

                if (existingProductIndex > -1) {
                    // Se o produto já existe, apenas atualiza a quantidade
                    orderItems[existingProductIndex].quantity += productQuantity;
                } else {
                    // Se não existe, adiciona um novo item
                    orderItems.push({ name: productName, quantity: productQuantity });
                }

                renderOrderItems();
                productNameSelect.value = ""; // Limpa a seleção do produto
                document.getElementById('productQuantity').value = 1; // Reseta a quantidade
            } else {
                alert('Por favor, selecione um produto e insira uma quantidade válida.');
            }
        }

        function removeProduct(index) {
            orderItems.splice(index, 1); // Remove o item do array
            renderOrderItems();
        }

        function renderOrderItems() {
            const orderItemsDiv = document.getElementById('orderItems');
            orderItemsDiv.innerHTML = ''; // Limpa a lista antes de renderizar

            if (orderItems.length === 0) {
                orderItemsDiv.innerHTML = '<p class="no-data">Nenhum produto adicionado ainda.</p>';
                return;
            }

            orderItems.forEach((item, index) => {
                const productItem = document.createElement('div');
                productItem.classList.add('product-item');
                productItem.innerHTML = `
                    <span class="product-name">${item.name}</span>
                    <span class="product-quantity">x${item.quantity}</span>
                    <button onclick="removeProduct(${index})" style="background-color: #dc3545; width: auto; padding: 5px 10px; margin-left: 10px;">Remover</button>
                `;
                orderItemsDiv.appendChild(productItem);
            });
        }

        function saveOrder() {
            const orderDate = document.getElementById('orderDate').value;
            const observations = document.getElementById('observations').value;

            const order = {
                date: orderDate,
                items: orderItems,
                observations: observations
            };

            localStorage.setItem('currentOrder', JSON.stringify(order));
            alert('Pedido salvo com sucesso!');
            console.log('Pedido Salvo:', order);
        }

        function finalizeAndSendOrder() {
            const orderDate = document.getElementById('orderDate').value;
            const observations = document.getElementById('observations').value;
            const whatsappRecipient = document.getElementById('whatsappRecipient').value.trim();

            if (!whatsappRecipient) {
                alert('Por favor, insira o número de telefone do WhatsApp (com o código do país).');
                return;
            }

            if (orderItems.length === 0) {
                alert('Por favor, adicione itens ao pedido antes de finalizar.');
                return;
            }

            let messageBody = `*Pedido - ${orderDate}*\n\n`;
            orderItems.forEach(item => {
                messageBody += `- ${item.name}: ${item.quantity}\n`;
            });

            if (observations) {
                messageBody += `\n*Observações:*\n${observations}`;
            }

            // Codifica a mensagem para URL
            const encodedMessage = encodeURIComponent(messageBody);
            
            // Remove o '+' do número se presente, pois o link do WhatsApp espera o número sem ele
            const cleanedRecipient = whatsappRecipient.startsWith('+') ? whatsappRecipient.substring(1) : whatsappRecipient;

            const whatsappUrl = `https://wa.me/${cleanedRecipient}?text=${encodedMessage}`;

            // Abre o WhatsApp em uma nova aba
            window.open(whatsappUrl, '_blank');

            alert('Você será redirecionado para o WhatsApp para enviar o pedido.');
        }


        function clearOrder() {
            orderItems.length = 0; // Esvazia o array de itens
            // Mantém a data atual
            const today = new Date();
            const yyyy = today.getFullYear();
            let mm = today.getMonth() + 1;
            let dd = today.getDate();
            if (dd < 10) dd = '0' + dd;
            if (mm < 10) mm = '0' + mm;
            document.getElementById('orderDate').value = yyyy + '-' + mm + '-' + dd;
            
            document.getElementById('observations').value = ""; // Limpa as observações
            document.getElementById('whatsappRecipient').value = ""; // Limpa o destinatário
            localStorage.removeItem('currentOrder'); // Remove do localStorage
            renderOrderItems();
            alert('Pedido limpo!');
        }

        // Função para carregar um pedido salvo (opcional, para persistência)
        function loadOrder() {
            const savedOrder = localStorage.getItem('currentOrder');
            if (savedOrder) {
                const order = JSON.parse(savedOrder);
                document.getElementById('orderDate').value = order.date;
                orderItems.push(...order.items); // Adiciona os itens salvos ao array
                document.getElementById('observations').value = order.observations;
                // Não carrega o destinatário do WhatsApp, pois pode mudar
                renderOrderItems();
            }
        }

        // Carrega o pedido ao iniciar a página se houver um salvo
        loadOrder();

    </script>
</body>
</html>
